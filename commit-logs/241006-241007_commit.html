<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007153044.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142319.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142710.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007143732.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145132.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145249.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144827.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144638.png"/><link rel="preload" as="image" href="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145020.png"/><link rel="stylesheet" href="/_next/static/css/9fec157a107b46e0.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-cceda007551b34ac.js"/><script src="/_next/static/chunks/fd9d1056-42bca7a501e26700.js" async=""></script><script src="/_next/static/chunks/23-0400f1ada3445968.js" async=""></script><script src="/_next/static/chunks/main-app-e0d78c455d046f20.js" async=""></script><script src="/_next/static/chunks/231-6a7b6dfd7bcbf59a.js" async=""></script><script src="/_next/static/chunks/app/layout-c9173ec0898b2734.js" async=""></script><title>Spaceofin Logs</title><meta name="description" content="A blog for study logs"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><nav class="font-mono mx-16"><ul class="relative min-h-32 m-14 mb-10 flex flex-col md:flex-row md:space-x-12 space-y-1 justify-center md:justify-start items-center text-2xl md:text-3xl z-0 tracking-tight text-zinc-900"><li><a href="/">Home</a></li><li><a href="/learning-logs">Learning Logs</a></li><li><a href="/commit-logs">Commit Logs</a></li></ul></nav><div class="flex justify-center py-10"><div class="page-background"><div class="flex flex-col prose dark:prose-invert w-full h-full max-h-none overflow-visible px-4"><h1 class="my-20 text-4xl">블로그 포스트 내 이미지 띄우기(with supabase)</h1>
<p><code>getMDXPosts</code>는 posts 버킷의 mdx 폴더의 파일 리스트를 가져와 해당 파일들을 다운로드 후 텍스트 변환하고 <code>string[]</code> 타입으로 반환하는 함수입니다.</p>
<pre><code class="language-javascript">export async function getMDXPosts() {
  const { data: fileList, error } = await supabase.storage
    .from(&quot;posts&quot;)
    .list(&quot;mdx&quot;);

  if (error) {
    console.error(&quot;Error occurred while loading the file list:&quot;, error.message);
    return [];
  }

  const posts = [];

  for (const file of fileList) {
    const { data, error } = await supabase.storage
      .from(&quot;posts&quot;)
      .download(`mdx/${file.name}`);

    if (error) {
      console.error(`Error downloading file ${file.name}:`, error.message);
      continue;
    }
    const text = await data.text();
    posts.push(text);
  }

  return posts;
}
</code></pre>
<p>업로드하는 mdx 파일 내 이미지들은 <code>![...]]</code>와 같은 형식으로 본문 텍스트 내에 포함되어 있습니다.</p>
<h2 class="mt-20 text-3xl text-blue-900">Q. 어떻게 이미지 파일을 페이지에 로드할 수 있을까요?</h2>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">Steps to solve</h3>
<h4 class="text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500">1. 이미지 파일 형식 변환</h4>
<p>mdx 파일에서의 이미지는 <code>![...](...)</code>와 같은 형식입니다. storage에 업로드 한 mdx 파일에 <code>![[...]]</code> 형식으로 들어있는 이미지 파일 이름에 대한 형식 변환이 필요합니다.</p>
<h4 class="text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500">2. <code>![...](...)</code> 형식의 텍스트를 포스트 본문 내 원래 이미지를 나타내는 텍스트가 있던 자리에 치환</h4>
<p>이렇게 하기 위해서 특정 post에 쓰이는 이미지 파일들을 해당 post의 파일명(확장자는 제외)을 폴더명으로 가지는 폴더에 저장합니다.
이후 해당 폴더에서 이미지 파일명들을 로드하여 배열에 저장하고 index를 사용하여 원래 <code>![[...]]</code> 형식의 이미지를 나타내는 텍스트가 있던 자리에 치환하도록 합니다.</p>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">Implementation</h3>
<h4 class="text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500">MDX 파일 내 이미지 삽입 부분 텍스트 치환</h4>
<h5 class="text-lg font-bold dark:text-xl mt-4 text-slate-600 dark:text-sky-500">정규 표현식</h5>
<p><code>![[...]]</code> 형식의 텍스트를 <code>![...](...)</code> 형식으로 치환합니다.</p>
<pre><code>/!\[\[.*?\]\]/g
</code></pre>
<h6 class="text-lg font-bold dark:text-xl mt-6 text-slate-600 dark:text-slate-600">+) String.prototype.replace()</h6>
<pre><code>replace(pattern, replacement)
</code></pre>
<pre><code>text.replace(/!\[\[.*?\]\]/g, () =&gt; {
    const replacement = imageUrls[imageIndex] ? `![](${imageUrls[imageIndex]})` : &quot;[not found image]&quot;;
    imageIndex += 1;
    return replacement;
  });
</code></pre>
<h4 class="text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500">이미지 파일이 존재하는 경우, 이미지를 포함한 변환된 텍스트를 posts 배열에 push</h4>
<pre><code>const result =
  imageUrls.length &gt; 0 ? replaceImageTexts({ text, imageUrls }) : text;

posts.push(result);
</code></pre>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">Implementation result</h3>
<p>post 본문 내 적절한 위치에 이미지가 보입니다.</p>
<p><img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007153044.png" alt=""/></p>
<h2 class="mt-20 text-3xl text-blue-900">Trouble Shooting</h2>
<p>storage의 posts 버킷의 mdx 폴더 내 파일명 로드 시, 첫번째 파일명이 <code>.emptyFolderPlaceholder</code>로 인식되는 문제입니다.</p>
<pre><code>  for (const file of fileList) {
    const { data, error } = await supabase.storage
      .from(&quot;posts&quot;)
      .download(`mdx/${file.name}`);

    if (error) {
      console.error(`Error downloading file ${file.name}:`, error.message);
      continue;
    }
    const text = await data.text();

    console.log(&quot;filename:&quot;, file.name);
    const imageUrls = await getImageUrls({ post: file.name });

    // console.log(imageUrls);

    const result =
      imageUrls.length &gt; 0 ? replaceImageTexts({ text, imageUrls }) : text;

    posts.push(result);
  }
</code></pre>
<p><img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142319.png" alt=""/></p>
<p><code>.emptyFolderPlaceholder</code>에 대해 출력해 봅니다.
<img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142710.png" alt=""/></p>
<p>위의 문제는 storage의 특정 폴더에서 모든 파일을 제거하면 <code>.emptyFolderPlaceholder</code>가 파일 리스트에 생성되는 문제라고 합니다.</p>
<p>이 문제에 대한 해결 방법은 아래의 사이트를 참고하였습니다.</p>
<pre><code>https://github.com/supabase/storage/issues/207
</code></pre>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">해결 방법1</h3>
<p>코드 작성</p>
<pre><code>const { data, error } = await supabase.storage
  .from(&#x27;bucket&#x27;)
  .remove([&#x27;path/to/folder&#x27;], {
    force: true, // required if folder isnt empty
  });
</code></pre>
<p>(이 방법은 시도해보지 않았습니다.)</p>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">해결 방법2</h3>
<p>supabase 의 <code>Table Editor</code> &gt; scheme: <code>storage</code> &gt; table: <code>object</code> 에서 <code>.emptyFolderPlaceholder</code>가 포함된 row를 삭제합니다.</p>
<p>(삭제 전)
<img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007143732.png" alt=""/></p>
<p>(삭제 후)
<img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145132.png" alt=""/></p>
<p>이제 다시 파일 목록을 출력해보면 <code>.emptyFolderPlaceholder</code>가 존재하지 않습니다.
<img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145249.png" alt=""/></p>
<h3 class="text-2xl dark:text-2xl text-sky-700 dark:text-sky-300">+) sql문</h3>
<p>supabase의 object 테이블의 특정 row를 삭제하기 위해 sql문을 실행하였습니다.</p>
<p>objects 테이블의 특정 row를 삭제하기 위한 sql문(에러)</p>
<pre><code>delete from objects
where bucket_id = &#x27;posts&#x27; and name = &#x27;mdx/.emptyFolderPlaceholder&#x27;;
</code></pre>
<p><img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144827.png" alt=""/>
objects 라는 테이블이 없다는 에러입니다.</p>
<p>해결 방법을 찾아보니 테이블이 속한 스키마를 먼저 명시해 주어야 한다고 합니다.</p>
<p>테이블 조회</p>
<pre><code>SELECT * FROM information_schema.tables WHERE table_name = &#x27;objects&#x27;;
</code></pre>
<p><img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144638.png" alt=""/>
objects 테이블의 스키마명은 storage입니다.</p>
<p>objects 테이블의 특정 row를 삭제하기 위한 sql문</p>
<pre><code>delete from storage.objects
where bucket_id = &#x27;posts&#x27; and name = &#x27;mdx/.emptyFolderPlaceholder&#x27;;
</code></pre>
<p><img class="mt-1 mb-8" src="https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145020.png" alt=""/></p>
<p>row 삭제에 성공하였습니다.</p></div></div></div><script src="/_next/static/chunks/webpack-cceda007551b34ac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/9fec157a107b46e0.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[5767,[\"231\",\"static/chunks/231-6a7b6dfd7bcbf59a.js\",\"185\",\"static/chunks/app/layout-c9173ec0898b2734.js\"],\"PostProvider\",1]\n9:I[231,[\"231\",\"static/chunks/231-6a7b6dfd7bcbf59a.js\",\"185\",\"static/chunks/app/layout-c9173ec0898b2734.js\"],\"\"]\nb:I[6130,[],\"\"]\n6:[\"slug\",\"241006-241007_commit\",\"d\"]\nc:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"A_hyAvGl7MjvCzIoIniqY\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"commit-logs\",\"241006-241007_commit\"],\"initialTree\":[\"\",{\"children\":[\"commit-logs\",{\"children\":[[\"slug\",\"241006-241007_commit\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"241006-241007_commit\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"commit-logs\",{\"children\":[[\"slug\",\"241006-241007_commit\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"commit-logs\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"commit-logs\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9fec157a107b46e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"$L8\",null,{\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"nav\",null,{\"className\":\"font-mono mx-16\",\"children\":[\"$\",\"ul\",null,{\"className\":\"relative min-h-32 m-14 mb-10 flex flex-col md:flex-row md:space-x-12 space-y-1 justify-center md:justify-start items-center text-2xl md:text-3xl z-0 tracking-tight text-zinc-900\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/learning-logs\",\"children\":\"Learning Logs\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/commit-logs\",\"children\":\"Commit Logs\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-center py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"page-background\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Spaceofin Logs\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A blog for study logs\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}]]\n3:null\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"flex flex-col prose dark:prose-invert w-full h-full max-h-none overflow-visible px-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"my-20 text-4xl\",\"children\":\"블로그 포스트 내 이미지 띄우기(with supabase)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"getMDXPosts\"}],\"는 posts 버킷의 mdx 폴더의 파일 리스트를 가져와 해당 파일들을 다운로드 후 텍스트 변환하고 \",[\"$\",\"code\",null,{\"children\":\"string[]\"}],\" 타입으로 반환하는 함수입니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript\",\"children\":\"export async function getMDXPosts() {\\n  const { data: fileList, error } = await supabase.storage\\n    .from(\\\"posts\\\")\\n    .list(\\\"mdx\\\");\\n\\n  if (error) {\\n    console.error(\\\"Error occurred while loading the file list:\\\", error.message);\\n    return [];\\n  }\\n\\n  const posts = [];\\n\\n  for (const file of fileList) {\\n    const { data, error } = await supabase.storage\\n      .from(\\\"posts\\\")\\n      .download(`mdx/${file.name}`);\\n\\n    if (error) {\\n      console.error(`Error downloading file ${file.name}:`, error.message);\\n      continue;\\n    }\\n    const text = await data.text();\\n    posts.push(text);\\n  }\\n\\n  return posts;\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"업로드하는 mdx 파일 내 이미지들은 \",[\"$\",\"code\",null,{\"children\":\"![...]]\"}],\"와 같은 형식으로 본문 텍스트 내에 포함되어 있습니다.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"className\":\"mt-20 text-3xl text-blue-900\",\"children\":\"Q. 어떻게 이미지 파일을 페이지에 로드할 수 있을까요?\"}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"Steps to solve\"}],\"\\n\",[\"$\",\"h4\",null,{\"className\":\"text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500\",\"children\":\"1. 이미지 파일 형식 변환\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"mdx 파일에서의 이미지는 \",[\"$\",\"code\",null,{\"children\":\"![...](...)\"}],\"와 같은 형식입니다. storage에 업로드 한 mdx 파일에 \",[\"$\",\"code\",null,{\"children\":\"![[...]]\"}],\" 형식으로 들어있는 이미지 파일 이름에 대한 형식 변환이 필요합니다.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"className\":\"text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500\",\"children\":[\"2. \",[\"$\",\"code\",null,{\"children\":\"![...](...)\"}],\" 형식의 텍스트를 포스트 본문 내 원래 이미지를 나타내는 텍스트가 있던 자리에 치환\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이렇게 하기 위해서 특정 post에 쓰이는 이미지 파일들을 해당 post의 파일명(확장자는 제외)을 폴더명으로 가지는 폴더에 저장합니다.\\n이후 해당 폴더에서 이미지 파일명들을 로드하여 배열에 저장하고 index를 사용하여 원래 \",[\"$\",\"code\",null,{\"children\":\"![[...]]\"}],\" 형식의 이미지를 나타내는 텍스트가 있던 자리에 치환하도록 합니다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"Implementation\"}],\"\\n\",[\"$\",\"h4\",null,{\"className\":\"text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500\",\"children\":\"MDX 파일 내 이미지 삽입 부분 텍스트 치환\"}],\"\\n\",[\"$\",\"h5\",null,{\"className\":\"text-lg font-bold dark:text-xl mt-4 text-slate-600 dark:text-sky-500\",\"children\":\"정규 표현식\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"![[...]]\"}],\" 형식의 텍스트를 \",[\"$\",\"code\",null,{\"children\":\"![...](...)\"}],\" 형식으로 치환합니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/!\\\\[\\\\[.*?\\\\]\\\\]/g\\n\"}]}],\"\\n\",[\"$\",\"h6\",null,{\"className\":\"text-lg font-bold dark:text-xl mt-6 text-slate-600 dark:text-slate-600\",\"children\":\"+) String.prototype.replace()\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"replace(pattern, replacement)\\n\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"text.replace(/!\\\\[\\\\[.*?\\\\]\\\\]/g, () =\u003e {\\n    const replacement = imageUrls[imageIndex] ? `![](${imageUrls[imageIndex]})` : \\\"[not found image]\\\";\\n    imageIndex += 1;\\n    return replacement;\\n  });\\n\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"className\":\"text-xl font-bold dark:text-xl mt-4 text-slate-800 dark:text-sky-500\",\"children\":\"이미지 파일이 존재하는 경우, 이미지를 포함한 변환된 텍스트를 posts 배열에 push\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"const result =\\n  imageUrls.length \u003e 0 ? replaceImageTexts({ text, imageUrls }) : text;\\n\\nposts.push(result);\\n\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"Implementation result\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"post 본문 내 적절한 위치에 이미지가 보입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007153044.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"className\":\"mt-20 text-3xl text-blue-900\",\"children\":\"Trouble Shooting\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"storage의 posts 버킷의 mdx 폴더 내 파일명 로드 시, 첫번째 파일명이 \",[\"$\",\"code\",null,{\"children\":\".emptyFolderPlaceholder\"}],\"로 인식되는 문제입니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"  for (const file of fileList) {\\n    const { data, error } = await supabase.storage\\n      .from(\\\"posts\\\")\\n      .download(`mdx/${file.name}`);\\n\\n    if (error) {\\n      console.error(`Error downloading file ${file.name}:`, error.message);\\n      continue;\\n    }\\n    const text = await data.text();\\n\\n    console.log(\\\"filename:\\\", file.name);\\n    const imageUrls = await getImageUrls({ post: file.name });\\n\\n    // console.log(imageUrls);\\n\\n    const result =\\n      imageUrls.length \u003e 0 ? replaceImageTexts({ text, imageUrls }) : text;\\n\\n    posts.push(result);\\n  }\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142319.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".emptyFolderPlaceholder\"}],\"에 대해 출력해 봅니다.\\n\",[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007142710.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위의 문제는 storage의 특정 폴더에서 모든 파일을 제거하면 \",[\"$\",\"code\",null,{\"children\":\".emptyFolderPlaceholder\"}],\"가 파일 리스트에 생성되는 문제라고 합니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 문제에 대한 해결 방법은 아래의 사이트를 참고하였습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"https://github.com/supabase/storage/issues/207\\n\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"해결 방법1\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"코드 작성\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"const { data, error } = await supabase.storage\\n  .from('bucket')\\n  .remove(['path/to/folder'], {\\n    force: true, // required if folder isnt empty\\n  });\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"(이 방법은 시도해보지 않았습니다.)\"}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"해결 방법2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"supabase 의 \",[\"$\",\"code\",null,{\"children\":\"Table Editor\"}],\" \u003e scheme: \",[\"$\",\"code\",null,{\"children\":\"storage\"}],\" \u003e table: \",[\"$\",\"code\",null,{\"children\":\"object\"}],\" 에서 \",[\"$\",\"code\",null,{\"children\":\".emptyFolderPlaceholder\"}],\"가 포함된 row를 삭제합니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"(삭제 전)\\n\",[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007143732.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"(삭제 후)\\n\",[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145132.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이제 다시 파일 목록을 출력해보면 \",[\"$\",\"code\",null,{\"children\":\".emptyFolderPlaceholder\"}],\"가 존재하지 않습니다.\\n\",[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145249.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"h3\",null,{\"className\":\"text-2xl dark:text-2xl text-sky-700 dark:text-sky-300\",\"children\":\"+) sql문\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"supabase의 object 테이블의 특정 row를 삭제하기 위해 sql문을 실행하였습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"objects 테이블의 특정 row를 삭제하기 위한 sql문(에러)\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"delete from objects\\nwhere bucket_id = 'posts' and name = 'mdx/.emptyFolderPlaceholder';\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144827.png\",\"alt\":\"\"}],\"\\nobjects 라는 테이블이 없다는 에러입니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"해결 방법을 찾아보니 테이블이 속한 스키마를 먼저 명시해 주어야 한다고 합니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"테이블 조회\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SELECT * FROM information_schema.tables WHERE table_name = 'objects';\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007144638.png\",\"alt\":\"\"}],\"\\nobjects 테이블의 스키마명은 storage입니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"objects 테이블의 특정 row를 삭제하기 위한 sql문\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"delete from storage.objects\\nwhere bucket_id = 'posts' and name = 'mdx/.emptyFolderPlaceholder';\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"className\":\"mt-1 mb-8\",\"src\":\"https://mizcysqzabsegohkcjcx.supabase.co/storage/v1/object/public/posts/commit-logs/images/Pasted%20image%2020241007145020.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"row 삭제에 성공하였습니다.\"}]]}]\n"])</script></body></html>