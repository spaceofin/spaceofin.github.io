<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/73bf310427694539.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-cceda007551b34ac.js"/><script src="/_next/static/chunks/fd9d1056-42bca7a501e26700.js" async=""></script><script src="/_next/static/chunks/23-0400f1ada3445968.js" async=""></script><script src="/_next/static/chunks/main-app-e0d78c455d046f20.js" async=""></script><script src="/_next/static/chunks/231-6a7b6dfd7bcbf59a.js" async=""></script><script src="/_next/static/chunks/app/layout-c9173ec0898b2734.js" async=""></script><title>Spaceofin Logs</title><meta name="description" content="A blog for study logs"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><nav class="font-mono mx-16"><ul class="relative min-h-32 mb-10 mt-20 md:my-14 mx-2 sm:mx-12 lg:m-14 flex flex-col md:flex-row md:space-x-12 lg:space-x-16 space-y-1 md:space-y-0 justify-center md:justify-start items-start sm:items-center md:items-center text-3xl lg:text-4xl z-0 tracking-tight text-zinc-900 pl-4 sm:pl-0"><li class="w-"><a href="/">Home</a></li><li><a href="/learning-logs">Learning Logs</a></li><li><a href="/commit-logs">Commit Logs</a></li></ul></nav><div class="flex justify-center py-10"><div class="page-background"><div class="flex flex-col prose dark:prose-invert w-full h-full max-h-none overflow-visible px-4"><h1 class="my-20 text-4xl">useSWR fallbackData 옵션 관련 이슈 처리</h1>
<h2 class="mt-20 text-3xl text-blue-900">Trouble</h2>
<p><code>useSWR</code>에서 <code>fallbackData</code> 옵션 사용 시, <code>revalidateIfStale</code> 옵션을 false로 두면 limit 값을 변경해도 refetch가 일어나지 않는 문제가 발생하였습니다.</p>
<pre><code>const { data, isLoading, error } = useSWR([page, limit, order],{
	fallbackData: initialTodos,
	revalidateIfStale: false,
});
</code></pre>
<p><code>revalidateIfStale</code>을 false 로 둔 이유는 default 값인 true로 둘 경우 limit 값을 변경할 때마다 이전에 이미 불러온 데이터임에도 캐시 데이터를 사용하지 않고 refetch가 일어났기 때문입니다.</p>
<h2 class="mt-20 text-3xl text-blue-900">Trouble 원인</h2>
<pre><code>https://github.com/vercel/swr/issues/284
</code></pre>
<p>위의 사이트를 참고하여 문제의 원인을 파악할 수 있었습니다.</p>
<p><code>fallbackData</code>는 각 key 값에 대해 초기값으로 할당되는 데이터입니다.
즉, limit을 변경하여 key 값이 변경되면 해당 key에 다시 fallbackData가 할당되며 <code>revalidateIfStale</code>이 false로 설정되어 있으므로 refetch가 일어나지 않고, limit 값이 또 바뀌어도 해당 키에 다시 <code>fallbackData</code>가 할당될 뿐이므로 데이터 리페칭이 일어나지 않는 것이었습니다.</p>
<h2 class="mt-20 text-3xl text-blue-900">Trouble 해결</h2>
<p>코드가 수행해야 하는 기능은 2가지 입니다.</p>
<pre><code>1. 페이지 진입 시에는 서버 컴포넌트로부터 전달된 초기데이터를 띄웁니다.
2. useSWR에 쓰이는 key 값에 대해 이전과 동일한 key 값이라면 새로 데이터 페칭을 하지 않고 캐시된 기존의 데이터를 사용합니다.
</code></pre>
<p><code>useSWR</code> 구문에서 <code>fallbackData</code> 옵션을 사용하지 않고, <code>SWRConfigContext</code> 구문에서 키값을 지정하여 초기 데이터 값을 할당하는 방법으로 구현하였습니다.</p>
<pre><code>const { data, isLoading, error } = useSWR([page, limit, order],{
	revalidateIfStale: false,
});
</code></pre>
<pre><code>&lt;SWRConfigContext fallback={{ [initialTodosKey]: initialTodos }}&gt;
	...
&lt;/SWRConfigContext&gt;
</code></pre>
<p>이렇게 하면 초기 페이지에 필요한 데이터에만 특정 key 값을 할당하여 다른 key 값들에는 초기 값이 할당되지 않도록 할 수 있고 초기 값이 없으므로 다른 키 값들은 처음 페칭되는 데이터를 캐시에 저장하고 이후 리페칭 없이 캐시된 데이터를 사용할 수 있습니다.</p>
<hr class="my-2"/></div></div></div><script src="/_next/static/chunks/webpack-cceda007551b34ac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/73bf310427694539.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[5767,[\"231\",\"static/chunks/231-6a7b6dfd7bcbf59a.js\",\"185\",\"static/chunks/app/layout-c9173ec0898b2734.js\"],\"PostProvider\",1]\n9:I[231,[\"231\",\"static/chunks/231-6a7b6dfd7bcbf59a.js\",\"185\",\"static/chunks/app/layout-c9173ec0898b2734.js\"],\"\"]\nb:I[6130,[],\"\"]\n6:[\"slug\",\"241126_commit\",\"d\"]\nc:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"EWZ6eEsnSLeffZ1eqUzuW\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"commit-logs\",\"241126_commit\"],\"initialTree\":[\"\",{\"children\":[\"commit-logs\",{\"children\":[[\"slug\",\"241126_commit\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"241126_commit\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"commit-logs\",{\"children\":[[\"slug\",\"241126_commit\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"commit-logs\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"commit-logs\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/73bf310427694539.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"$L8\",null,{\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"nav\",null,{\"className\":\"font-mono mx-16\",\"children\":[\"$\",\"ul\",null,{\"className\":\"relative min-h-32 mb-10 mt-20 md:my-14 mx-2 sm:mx-12 lg:m-14 flex flex-col md:flex-row md:space-x-12 lg:space-x-16 space-y-1 md:space-y-0 justify-center md:justify-start items-start sm:items-center md:items-center text-3xl lg:text-4xl z-0 tracking-tight text-zinc-900 pl-4 sm:pl-0\",\"children\":[[\"$\",\"li\",null,{\"className\":\"w-\",\"children\":[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/learning-logs\",\"children\":\"Learning Logs\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/commit-logs\",\"children\":\"Commit Logs\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-center py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"page-background\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Spaceofin Logs\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A blog for study logs\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}]]\n3:null\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"flex flex-col prose dark:prose-invert w-full h-full max-h-none overflow-visible px-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"my-20 text-4xl\",\"children\":\"useSWR fallbackData 옵션 관련 이슈 처리\"}],\"\\n\",[\"$\",\"h2\",null,{\"className\":\"mt-20 text-3xl text-blue-900\",\"children\":\"Trouble\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"useSWR\"}],\"에서 \",[\"$\",\"code\",null,{\"children\":\"fallbackData\"}],\" 옵션 사용 시, \",[\"$\",\"code\",null,{\"children\":\"revalidateIfStale\"}],\" 옵션을 false로 두면 limit 값을 변경해도 refetch가 일어나지 않는 문제가 발생하였습니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"const { data, isLoading, error } = useSWR([page, limit, order],{\\n\\tfallbackData: initialTodos,\\n\\trevalidateIfStale: false,\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"revalidateIfStale\"}],\"을 false 로 둔 이유는 default 값인 true로 둘 경우 limit 값을 변경할 때마다 이전에 이미 불러온 데이터임에도 캐시 데이터를 사용하지 않고 refetch가 일어났기 때문입니다.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"className\":\"mt-20 text-3xl text-blue-900\",\"children\":\"Trouble 원인\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"https://github.com/vercel/swr/issues/284\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 사이트를 참고하여 문제의 원인을 파악할 수 있었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"fallbackData\"}],\"는 각 key 값에 대해 초기값으로 할당되는 데이터입니다.\\n즉, limit을 변경하여 key 값이 변경되면 해당 key에 다시 fallbackData가 할당되며 \",[\"$\",\"code\",null,{\"children\":\"revalidateIfStale\"}],\"이 false로 설정되어 있으므로 refetch가 일어나지 않고, limit 값이 또 바뀌어도 해당 키에 다시 \",[\"$\",\"code\",null,{\"children\":\"fallbackData\"}],\"가 할당될 뿐이므로 데이터 리페칭이 일어나지 않는 것이었습니다.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"className\":\"mt-20 text-3xl text-blue-900\",\"children\":\"Trouble 해결\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"코드가 수행해야 하는 기능은 2가지 입니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"1. 페이지 진입 시에는 서버 컴포넌트로부터 전달된 초기데이터를 띄웁니다.\\n2. useSWR에 쓰이는 key 값에 대해 이전과 동일한 key 값이라면 새로 데이터 페칭을 하지 않고 캐시된 기존의 데이터를 사용합니다.\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"useSWR\"}],\" 구문에서 \",[\"$\",\"code\",null,{\"children\":\"fallbackData\"}],\" 옵션을 사용하지 않고, \",[\"$\",\"code\",null,{\"children\":\"SWRConfigContext\"}],\" 구문에서 키값을 지정하여 초기 데이터 값을 할당하는 방법으로 구현하였습니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"const { data, isLoading, error } = useSWR([page, limit, order],{\\n\\trevalidateIfStale: false,\\n});\\n\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"\u003cSWRConfigContext fallback={{ [initialTodosKey]: initialTodos }}\u003e\\n\\t...\\n\u003c/SWRConfigContext\u003e\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이렇게 하면 초기 페이지에 필요한 데이터에만 특정 key 값을 할당하여 다른 key 값들에는 초기 값이 할당되지 않도록 할 수 있고 초기 값이 없으므로 다른 키 값들은 처음 페칭되는 데이터를 캐시에 저장하고 이후 리페칭 없이 캐시된 데이터를 사용할 수 있습니다.\"}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"my-2\",\"children\":\"$undefined\"}]]}]\n"])</script></body></html>